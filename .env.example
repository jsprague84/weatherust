# Copy to .env and fill in your actual secrets (do NOT commit .env)

# ==============================================================================
# CORE CONFIGURATION
# ==============================================================================

# Timezone for Ofelia's cron scheduling
TZ=America/Chicago

# Absolute host path to this .env file (used by Ofelia to mount into containers)
# Update this to match your server's actual path
# Examples:
#   /home/ubuntu/docker-compose/weatherust/.env
#   /opt/weatherust/.env
ENV_FILE_HOST_PATH=/absolute/path/to/your/weatherust/.env

# Debug logging for Gotify API calls (masks token, shows URL/source/message lengths)
# Set to true or 1 to enable
# GOTIFY_DEBUG=false


# ==============================================================================
# NOTIFICATION SETTINGS (Gotify and/or ntfy.sh)
# ==============================================================================

# You can use Gotify, ntfy.sh, or both simultaneously!
# Services send to both if both are configured.

# ---------- Gotify Configuration ----------
# Gotify server URL (used by all services)
GOTIFY_URL=https://gotify.example.com/message

# Service-specific Gotify tokens (REQUIRED for each service you want to use)
# Each service checks only its own key - no shared fallback key
#
# Simple setup (same key for all services - all notifications in one Gotify app):
#   WEATHERUST_GOTIFY_KEY=your_gotify_token
#   UPDATEMON_GOTIFY_KEY=your_gotify_token
#   DOCKERMON_GOTIFY_KEY=your_gotify_token
#   SPEEDY_GOTIFY_KEY=your_gotify_token
#   UPDATECTL_GOTIFY_KEY=your_gotify_token
#
# Organized setup (different keys per service - separate Gotify apps):
#   WEATHERUST_GOTIFY_KEY=token_for_weather_app
#   UPDATEMON_GOTIFY_KEY=token_for_updates_app
#   DOCKERMON_GOTIFY_KEY=token_for_docker_app
#   SPEEDY_GOTIFY_KEY=token_for_speedtest_app
#   UPDATECTL_GOTIFY_KEY=token_for_updatectl_app
#
WEATHERUST_GOTIFY_KEY=your_weatherust_gotify_token_here
UPDATEMON_GOTIFY_KEY=your_updatemon_gotify_token_here
DOCKERMON_GOTIFY_KEY=your_dockermon_gotify_token_here
SPEEDY_GOTIFY_KEY=your_speedynotify_gotify_token_here
UPDATECTL_GOTIFY_KEY=your_updatectl_gotify_token_here

# Alternative: Use a file containing the Gotify key (useful with Docker secrets)
# This is a fallback if the service-specific key above is not set
# GOTIFY_KEY_FILE=/run/secrets/gotify_key

# ---------- ntfy.sh Configuration ----------
# ntfy.sh server URL (default: https://ntfy.sh)
# Use your self-hosted instance:
NTFY_URL=https://ntfy.js-node.com

# Optional: Authentication token for self-hosted ntfy servers
# NTFY_AUTH=your_ntfy_auth_token

# Service-specific ntfy topics (if set, service sends to ntfy)
# Each service publishes to its own topic
# You can use the same topic for all services or separate topics
#
# Simple setup (same topic for all - all notifications in one feed):
#   WEATHERUST_NTFY_TOPIC=weatherust-alerts
#   UPDATEMON_NTFY_TOPIC=weatherust-alerts
#   DOCKERMON_NTFY_TOPIC=weatherust-alerts
#   SPEEDY_NTFY_TOPIC=weatherust-alerts
#   UPDATECTL_NTFY_TOPIC=weatherust-alerts
#
# Organized setup (different topics per service):
#   WEATHERUST_NTFY_TOPIC=weather
#   UPDATEMON_NTFY_TOPIC=updates
#   DOCKERMON_NTFY_TOPIC=docker
#   SPEEDY_NTFY_TOPIC=speedtest
#   UPDATECTL_NTFY_TOPIC=update-actions
#
# Example (uncomment to enable):
# WEATHERUST_NTFY_TOPIC=weatherust
# UPDATEMON_NTFY_TOPIC=weatherust
# DOCKERMON_NTFY_TOPIC=weatherust
# SPEEDY_NTFY_TOPIC=weatherust
# UPDATECTL_NTFY_TOPIC=weatherust

# Debug logging for ntfy (masks token, shows URL/topic/message lengths)
# Set to true or 1 to enable
# NTFY_DEBUG=false


# ==============================================================================
# WEATHERUST - Weather monitoring and notifications
# ==============================================================================

# OpenWeatherMap API key (required)
# Get your free API key at: https://openweathermap.org/api
OWM_API_KEY=your_openweathermap_api_key_here

# Default location settings
# Provide EITHER DEFAULT_ZIP (preferred) OR DEFAULT_LOCATION
# DEFAULT_ZIP takes precedence when both are set
DEFAULT_ZIP=52726
DEFAULT_UNITS=imperial

# Alternative: Use location string instead of ZIP
# DEFAULT_LOCATION=Davenport,IA,US


# ==============================================================================
# SPEEDYNOTIFY - Internet speed test monitoring
# ==============================================================================

# Minimum acceptable speeds in Mbps (below these values triggers alerts)
SPEEDTEST_MIN_DOWN=300
SPEEDTEST_MIN_UP=20

# Optional: Pin to specific Ookla speedtest server ID
# Find server IDs at: https://www.speedtest.net/speedtest-servers.php
# SPEEDTEST_SERVER_ID=12345


# ==============================================================================
# DOCKERMON - Docker container health monitoring
# ==============================================================================

# CPU and memory warning thresholds (percent)
CPU_WARN_PCT=85
MEM_WARN_PCT=90

# Send notification even when all containers are healthy (default: false)
HEALTH_NOTIFY_ALWAYS=false

# Ignore specific containers (comma-separated: name, ID, or service name)
# Example: DOCKERMON_IGNORE=weatherust-weatherust-1,weatherust-speedynotify-1
# DOCKERMON_IGNORE=


# ==============================================================================
# UPDATEMON - OS and Docker update monitoring
# ==============================================================================

# Comma-separated list of servers to check (format: name:user@host or user@host)
# Examples:
#   UPDATE_SERVERS=server1:ubuntu@192.168.1.10,server2:admin@192.168.1.20
#   UPDATE_SERVERS=ubuntu@192.168.1.10,fedora@192.168.1.30
#
# NEW: Include localhost with custom name by using "local" or "localhost" as host:
#   UPDATE_SERVERS=docker-vm:local,Cloud VM1:ubuntu@cloud-vm1.js-node.com
#   UPDATE_SERVERS=My Server:localhost,server2:ubuntu@192.168.1.20
#
# This eliminates the need for --local flag and includes localhost in scheduled runs
# UPDATE_SERVERS=

# SSH key path for passwordless authentication to remote servers
# UPDATE_SSH_KEY=/home/ubuntu/.ssh/id_ed25519

# Optional: Customize how localhost appears in reports
# UPDATE_LOCAL_NAME=docker-vm          # Name to use instead of "localhost"
# UPDATE_LOCAL_DISPLAY=192.168.1.100   # IP/hostname to show instead of "local"
#
# Example output with these set:
#   üñ•Ô∏è  docker-vm (192.168.1.100)
# Instead of:
#   üñ•Ô∏è  localhost (local)


# ==============================================================================
# UPDATECTL - Apply OS and Docker updates (companion to updatemon)
# ==============================================================================

# updatectl uses the same UPDATE_SERVERS and UPDATE_SSH_KEY as updatemon above
# No additional configuration required for server connectivity

# IMPORTANT: updatectl can MODIFY your systems by applying updates
# Always test with --dry-run first to preview changes
#
# Manual usage examples:
#   docker compose exec updatectl_runner /app/updatectl all --dry-run --local
#   docker compose exec updatectl_runner /app/updatectl os --yes --local
#   docker compose exec updatectl_runner /app/updatectl docker --all --yes --local
#
# Automated updates via Ofelia (see docker-compose.yml):
#   Ofelia jobs are COMMENTED OUT by default for safety
#   Uncomment schedules in docker-compose.yml to enable automated updates

# ---------- Container Restart Policy ----------
# After pulling Docker images, updatectl can automatically restart containers
# Control this behavior with the following settings:

# Global restart policy (applies to all servers unless excluded)
# Options:
#   all-except-webhook  - Restart all containers except updatectl_webhook (default)
#   none               - Pull images only, never restart containers automatically
UPDATECTL_RESTART_POLICY=all-except-webhook

# Per-server container exclusions (in addition to policy)
# Exclude specific containers from automatic restart on each server
# Format: UPDATECTL_RESTART_EXCLUDE_<SERVER_NAME>=container1,container2,container3
# Server name must match exactly (with - replaced by _, spaces by _, uppercase)
#
# Examples:
#   UPDATECTL_RESTART_EXCLUDE_DOCKER_VM=ofelia,traefik,portainer
#   UPDATECTL_RESTART_EXCLUDE_CLOUD_VM1=watchtower,diun
#   UPDATECTL_RESTART_EXCLUDE_OFFICE_HP_WS=homepage
#
# Common containers you might want to exclude:
#   - ofelia (cron scheduler - restarting disrupts scheduled jobs)
#   - traefik (reverse proxy - causes brief downtime)
#   - portainer (management UI - active sessions would disconnect)
#   - watchtower (auto-updater - might conflict)
#
# UPDATECTL_RESTART_EXCLUDE_DOCKER_VM=
# UPDATECTL_RESTART_EXCLUDE_CLOUD_VM1=
# UPDATECTL_RESTART_EXCLUDE_CLOUD_VM2=


# ==============================================================================
# WEBHOOK SERVER - Interactive update buttons in ntfy notifications
# ==============================================================================

# IMPORTANT: The webhook server allows ntfy action buttons to trigger updates
# This enables "one-click" updates from your phone/browser via ntfy.sh

# Webhook secret token (REQUIRED for webhook functionality)
# Generate a strong random token (32+ characters recommended):
#   openssl rand -base64 32
# This token secures webhook endpoints so only your ntfy buttons can trigger updates
UPDATECTL_WEBHOOK_SECRET=your_secure_random_token_here

# Webhook server domain (REQUIRED for Traefik routing)
# This is the public domain that Traefik will route to the webhook server
# Must be a subdomain you control with DNS pointing to your server
# Examples: webhook.yourdomain.com, updatectl-webhook.yourdomain.com
UPDATECTL_WEBHOOK_DOMAIN=webhook.js-node.app

# Webhook server URL (REQUIRED for ntfy action buttons)
# This is the public HTTPS URL that ntfy.sh will POST to when buttons are clicked
# Must match the domain above with https:// prefix
UPDATECTL_WEBHOOK_URL=https://webhook.js-node.app

# How it works:
# 1. updatemon detects available updates across all servers
# 2. Sends ONE ntfy notification PER SERVER that has updates
#    - Each notification shows that server's update details
#    - Includes action buttons (currently 2, room for up to 3 per server):
#      * "Update OS" - if OS updates available
#      * "Update Docker" - if Docker updates available
#    - Action buttons contain webhook URLs with:
#      * Server name (which server to update)
#      * Update type (OS or Docker all)
#      * Secret token (for authentication)
# 3. When you click a button in ntfy, it POSTs to the webhook server
# 4. Webhook server validates token and triggers updatectl in background
# 5. Update results are sent as new ntfy notifications
#
# Note: Gotify still receives a single notification with all server details

# Security notes:
# - Webhook server only listens on localhost (127.0.0.1:8080) by default
# - All webhook requests require the secret token
# - If exposing webhooks externally, use HTTPS and strong tokens
# - Consider IP allowlisting if exposing to the internet


# ==============================================================================
# DEVELOPMENT / TESTING
# ==============================================================================

# Image tag overrides for pre-merge testing
# Set these to test feature branches, PRs, or specific commits
# Leave commented to use :latest from main branch
#
# Examples:
#   WEATHERUST_TAG=feature-my-feature
#   WEATHERUST_TAG=pr-42
#   WEATHERUST_TAG=sha-abc1234
#   SPEEDYNOTIFY_TAG=feature-speedtest-v2
#   DOCKERMON_TAG=sha-def5678
#   UPDATEMON_TAG=feature-update-checker
#   UPDATECTL_TAG=feature-auto-updater
#
# WEATHERUST_TAG=
# SPEEDYNOTIFY_TAG=
# DOCKERMON_TAG=
# UPDATEMON_TAG=
# UPDATECTL_TAG=
